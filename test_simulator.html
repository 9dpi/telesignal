<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantix Trading Simulator - Isolated Test</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-base: #000000;
            --bg-surface: #0f172a;
            /* Slate 900 */
            --bg-card: rgba(15, 23, 42, 0.6);
            --quantix-accent: #38bdf8;
            /* Sky 400 */
            --quantix-purple: #818cf8;
            /* Indigo 400 */
            --text-primary: #f8fafc;
            /* Slate 50 */
            --text-secondary: #94a3b8;
            /* Slate 400 */
            --trade-up: #10b981;
            /* Emerald 500 */
            --trade-down: #ef4444;
            /* Red 500 */
            --border-subtle: rgba(148, 163, 184, 0.1);
            --font-main: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        body {
            background: var(--bg-base);
            color: var(--text-primary);
            font-family: var(--font-main);
            padding: 20px;
            max-width: 480px;
            margin: 0 auto;
        }

        /* --- Simulator Styles (Synced with index.html) --- */
        #trading-simulator {
            background: var(--bg-surface);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-subtle);
            margin-bottom: 20px;
        }

        .trade-card {
            background: var(--bg-card);
            border-left: 3px solid var(--text-secondary);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .trade-card.win {
            border-left-color: var(--trade-up);
        }

        .trade-card.loss {
            border-left-color: var(--trade-down);
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .trade-symbol {
            font-family: var(--font-mono);
            font-weight: 700;
        }

        .trade-pnl {
            font-weight: 700;
            font-family: var(--font-mono);
        }

        .trade-pnl.green {
            color: var(--trade-up);
        }

        .trade-pnl.red {
            color: var(--trade-down);
        }

        .trade-info {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.7rem;
            margin-bottom: 10px;
            font-family: var(--font-mono);
        }

        .trade-actions {
            display: flex;
            justify-content: flex-end;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 600;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--trade-down);
            color: white;
            border-color: var(--trade-down);
        }

        /* Signal Card Styles for Simulation Test */
        .signal-card {
            background: rgba(15, 23, 42, 0.2);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .sig-sim-zone {
            margin-top: 1rem;
            border-top: 1px solid var(--border-subtle);
            padding-top: 1rem;
        }

        /* Test Controls Panel */
        .test-controls {
            margin-top: 30px;
            padding: 15px;
            background: #1e1e1e;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .test-controls button {
            margin: 5px;
            padding: 8px 12px;
            cursor: pointer;
            background: #2d2d2d;
            border: 1px solid #444;
            color: #ddd;
            border-radius: 4px;
        }

        .test-controls button:hover {
            background: #3d3d3d;
        }
    </style>
</head>

<body>

    <h3 style="text-align:center; color:var(--quantix-accent); letter-spacing:-0.5px;">SIMULATOR UI SYNC TEST</h3>

    <!-- QUANTIX TRADING SIMULATOR UI (Synced) -->
    <div id="trading-simulator">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
            <span style="font-size:0.7rem; color:var(--text-secondary); font-weight:700; text-transform:uppercase;">DEMO
                ACCOUNT</span>
            <button onclick="simulator.resetAccount()"
                style="background:none; border:none; color:var(--text-secondary); cursor:pointer; font-size:0.7rem;">â†º
                Reset</button>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:1rem;">
            <div>
                <div style="font-size:0.65rem; color:var(--text-secondary);">BALANCE</div>
                <div id="sim-balance"
                    style="font-size:1.1rem; font-weight:700; color:white; font-family:var(--font-mono);">$50,000.00
                </div>
            </div>
            <div style="text-align:right;">
                <div style="font-size:0.65rem; color:var(--text-secondary);">EQUITY</div>
                <div id="sim-equity"
                    style="font-size:1.1rem; font-weight:700; color:var(--quantix-accent); font-family:var(--font-mono);">
                    $50,000.00</div>
            </div>
        </div>

        <!-- Manual Trade Actions -->
        <h4
            style="margin:0 0 10px 0; font-size:0.7rem; color:var(--text-secondary); border-bottom:1px solid var(--border-subtle); padding-bottom:4px;">
            MANUAL ENTRY</h4>
        <div style="display:flex; gap:10px; margin-bottom:1rem;">
            <button onclick="manualLong()"
                style="flex:1; background:rgba(16, 185, 129, 0.1); border:1px solid var(--trade-up); color:var(--trade-up); padding:10px; border-radius:4px; font-weight:700; cursor:pointer;">
                BUY
            </button>
            <button onclick="manualShort()"
                style="flex:1; background:rgba(239, 68, 68, 0.1); border:1px solid var(--trade-down); color:var(--trade-down); padding:10px; border-radius:4px; font-weight:700; cursor:pointer;">
                SELL
            </button>
        </div>

        <!-- Active Positions List -->
        <div
            style="font-size:0.7rem; color:var(--text-secondary); font-weight:700; margin-bottom:0.5rem; text-transform:uppercase;">
            OPEN POSITIONS</div>
        <div id="sim-positions-list" style="max-height:200px; overflow-y:auto;">
            <!-- Positions injected by JS -->
        </div>
    </div>

    <!-- MOCK SIGNAL CARD (Testing Flow) -->
    <div class="signal-card">
        <div style="color:var(--quantix-accent); font-weight:700; margin-bottom:10px;">SIGNAL #TEST01</div>
        <div style="font-size:0.8rem; margin-bottom:5px;">Status: <span id="mock-sig-status"
                style="font-weight:bold; color:var(--trade-up);">ACTIVE</span></div>
        <div style="font-size:0.8rem; color:var(--text-secondary);">EURUSD | Buy @ <span id="mock-entry">1.08500</span>
        </div>

        <!-- Simulation Zone Injection Point -->
        <div class="sig-sim-zone" id="mock-sim-zone">
            <!-- JS will inject button here -->
        </div>
    </div>

    <!-- TEST CONTROLS -->
    <div class="test-controls">
        <div style="margin-bottom:10px; color:#fff;">
            Market Price: <span id="test-price-display"
                style="font-family:monospace; font-weight:bold; color:var(--quantix-accent);">1.08500</span>
        </div>
        <button onclick="movePrice(0.0005)">ðŸ“ˆ +5 pips</button>
        <button onclick="movePrice(-0.0005)">ðŸ“‰ -5 pips</button>
        <button onclick="movePrice(0.0020)">ðŸš€ +20 pips</button>
        <button onclick="movePrice(-0.0020)">ðŸ©¸ -20 pips</button>
        <hr style="border-color:#444; margin:10px 0;">
        <button onclick="setSignalState('ACTIVE')">Set Signal ACTIVE</button>
        <button onclick="setSignalState('EXPIRED')">Set Signal EXPIRED</button>
    </div>

    <script src="simulator.js"></script>
    <script>
        // Init Simulator
        window.simulator.init();
        lucide.createIcons();

        // Mock Data
        let currentMockPrice = 1.08500;
        let signalState = 'ACTIVE';

        // Initial Update
        window.simulator.updatePrice(currentMockPrice);
        renderMockSignal();

        function manualLong() {
            const tp = currentMockPrice + 0.0020;
            const sl = currentMockPrice - 0.0010;
            window.simulator.openPosition('BUY', 'EURUSD', currentMockPrice, tp, sl);
        }

        function manualShort() {
            const tp = currentMockPrice - 0.0020;
            const sl = currentMockPrice + 0.0010;
            window.simulator.openPosition('SELL', 'EURUSD', currentMockPrice, tp, sl);
        }

        function movePrice(delta) {
            currentMockPrice += delta;
            currentMockPrice = Math.round(currentMockPrice * 100000) / 100000;
            document.getElementById('test-price-display').innerText = currentMockPrice.toFixed(5);
            window.simulator.updatePrice(currentMockPrice);
        }

        function setSignalState(state) {
            signalState = state;
            document.getElementById('mock-sig-status').innerText = state;
            document.getElementById('mock-sig-status').style.color = state === 'ACTIVE' ? 'var(--trade-up)' : 'var(--text-secondary)';
            renderMockSignal();
        }

        function renderMockSignal() {
            const container = document.getElementById('mock-sim-zone');
            container.innerHTML = ''; // Clear

            if (signalState === 'ACTIVE') {
                const btnHtml = `
                    <button onclick="simulator.openPosition('BUY', 'EURUSD', ${currentMockPrice}, ${currentMockPrice + 0.0020}, ${currentMockPrice - 0.0010}, 1.0, 'TEST_SIG')"
                        style="width:100%; padding:12px; background:var(--quantix-accent); color:black; border:none; border-radius:4px; font-weight:700; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px; transition: all 0.2s;">
                        <i data-lucide="play-circle" size="16"></i> TRADING SIMULATION (DEMO)
                    </button>
                `;
                container.innerHTML = btnHtml;
            } else {
                const msgHtml = `
                    <div style="padding:12px; background:rgba(255,255,255,0.05); border:1px solid var(--border-subtle); border-radius:4px; text-align:center;">
                        <div style="font-size:0.75rem; color:var(--text-secondary); font-weight:600; margin-bottom:4px;">â›” SIGNAL EXPIRED</div>
                        <div style="font-size:0.7rem; color:#64748b;">Entry window has closed. Trading unavailable.</div>
                    </div>
                `;
                container.innerHTML = msgHtml;
            }
            lucide.createIcons();
        }
    </script>
</body>

</html>